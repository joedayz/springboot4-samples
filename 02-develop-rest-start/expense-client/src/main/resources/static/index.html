<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Expenses Client</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: system-ui, -apple-system, sans-serif; background: #f5f7fa; color: #333; }
        .container { max-width: 720px; margin: 2rem auto; padding: 0 1rem; }
        h1 { font-size: 1.8rem; margin-bottom: 1.5rem; color: #1a1a2e; }
        h3 { font-size: 1.1rem; margin-bottom: 0.75rem; color: #16213e; }
        .card { background: #fff; border-radius: 8px; padding: 1.5rem; margin-bottom: 1.5rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        form { display: flex; flex-wrap: wrap; gap: 0.5rem; align-items: flex-end; }
        label { display: flex; flex-direction: column; font-size: 0.85rem; color: #555; flex: 1; min-width: 140px; }
        input, select { margin-top: 0.25rem; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px; font-size: 0.95rem; }
        input:focus, select:focus { outline: none; border-color: #4361ee; }
        button { padding: 0.5rem 1.25rem; background: #4361ee; color: #fff; border: none; border-radius: 4px; font-size: 0.95rem; cursor: pointer; align-self: flex-end; }
        button:hover { background: #3a56d4; }
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; padding: 0.5rem; border-bottom: 2px solid #e0e0e0; font-size: 0.85rem; color: #777; text-transform: uppercase; }
        td { padding: 0.6rem 0.5rem; border-bottom: 1px solid #f0f0f0; font-size: 0.95rem; }
        tr:hover td { background: #f9f9ff; }
        .badge { display: inline-block; padding: 0.15rem 0.5rem; border-radius: 3px; font-size: 0.8rem; }
        .badge-cash { background: #d4edda; color: #155724; }
        .badge-credit { background: #cce5ff; color: #004085; }
        .badge-debit { background: #fff3cd; color: #856404; }
        .empty { text-align: center; padding: 2rem; color: #999; }
        .msg { padding: 0.5rem 1rem; border-radius: 4px; margin-bottom: 1rem; display: none; font-size: 0.9rem; }
        .msg-error { background: #f8d7da; color: #721c24; }
        .msg-ok { background: #d4edda; color: #155724; }
    </style>
</head>
<body>
<div class="container">
    <h1>Expenses Client</h1>

    <div id="msg" class="msg"></div>

    <div class="card">
        <h3>Add an expense</h3>
        <form id="expenseForm">
            <label>Name
                <input type="text" id="name" required placeholder="e.g. Spring Boot course"/>
            </label>
            <label>Amount
                <input type="text" id="amount" required placeholder="e.g. 25.50"/>
            </label>
            <label>Payment Method
                <select id="paymentMethod" required>
                    <option value="">-- select --</option>
                    <option value="CASH">Cash</option>
                    <option value="CREDIT_CARD">Credit Card</option>
                    <option value="DEBIT_CARD">Debit Card</option>
                </select>
            </label>
            <button type="submit">Save</button>
        </form>
    </div>

    <div class="card">
        <h3>Expenses</h3>
        <div id="tableContainer"></div>
    </div>
</div>

<script>
    const API = '/expenses';

    async function loadExpenses() {
        try {
            const res = await fetch(API);
            const data = await res.json();
            renderTable(data);
        } catch (e) {
            showMsg('Could not load expenses', true);
        }
    }

    function renderTable(expenses) {
        const container = document.getElementById('tableContainer');
        if (!expenses || expenses.length === 0) {
            container.innerHTML = '<p class="empty">No expenses yet.</p>';
            return;
        }
        const badgeClass = m => m === 'CASH' ? 'badge-cash' : m === 'CREDIT_CARD' ? 'badge-credit' : 'badge-debit';
        const label = m => m.replace('_', ' ').toLowerCase().replace(/\b\w/g, c => c.toUpperCase());
        container.innerHTML =
            '<table><thead><tr><th>Name</th><th>Amount</th><th>Payment</th></tr></thead><tbody>' +
            expenses.map(e =>
                `<tr><td>${esc(e.name)}</td><td>$${esc(e.amount)}</td><td><span class="badge ${badgeClass(e.paymentMethod)}">${label(e.paymentMethod)}</span></td></tr>`
            ).join('') +
            '</tbody></table>';
    }

    document.getElementById('expenseForm').addEventListener('submit', async (ev) => {
        ev.preventDefault();
        const body = {
            name: document.getElementById('name').value,
            amount: document.getElementById('amount').value,
            paymentMethod: document.getElementById('paymentMethod').value
        };
        try {
            const res = await fetch(API, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(body)
            });
            if (!res.ok) throw new Error('Server error');
            showMsg('Expense created!', false);
            ev.target.reset();
            loadExpenses();
        } catch (e) {
            showMsg('Error creating expense', true);
        }
    });

    function showMsg(text, isError) {
        const el = document.getElementById('msg');
        el.textContent = text;
        el.className = 'msg ' + (isError ? 'msg-error' : 'msg-ok');
        el.style.display = 'block';
        setTimeout(() => el.style.display = 'none', 3000);
    }

    function esc(s) {
        const d = document.createElement('div');
        d.textContent = s;
        return d.innerHTML;
    }

    loadExpenses();
</script>
</body>
</html>
